# Proposal: OCR Image to Text Command
We need a command line application written in golang and open ai that ocrs all of the images in the current working directory (by default or optionally by a specified directory).

## Functional Requirements

The images contain photos of a journal with handwritten text. The images are named in alphabetical order (eg. Img-0001.jpg… Img-N.jog). The results of processing each image must be concatenated together in order in a file called output.txt. The file name should be configurable, but default to this one.  When the program is completed, in addition the output file location, the total cost and cost per image should be printed to the screen. The images must be processed in parallel, with a default value of 10. Concurrency levels should be configurable.  

The result for each image should start with a horizontal rule, followed by the image name, followed by a line break, followed by the date of the journal entry, followed by a line break, followed by the transcript of the text. 

The date can be found at the top of some of the pages. If the date is not transcribed at the top of the page, the date from the previous page should be carried forward instead. There should be a configurable parameter for the „start date“ that should be used if the first page does not contain a date.  

The text from the images should be transcribed with all line breaks exactly as they appear in the image. Maintain punctuation, spacing and wording exactly as written. This part must use an api call from open ai. API calls that fail may be retried up to 5 times. The open api key should taken as config. It should be validated using an endpoint that open api provides (maybe one related to metered usage). 


## Non-Functional Requirements

Application implementation, ports, dtos and entities should all be in the `internal/orc` package, which can serve as the 'domain' package. Adapters can be implemented in sub modules nested inside of the domain module (eg. `internal/ocr/client`). Each adapter implementation imports their dtos and type checks their implementation structure against the ports in the domain module. 

The application is initialized and the dependencies should be injected in the main func of the `cmd/ocr` package. 

Test cases for the application logic should use mocks of the ports generated by mockery in `_test` files. The happy path and error paths should be covered. Application errors should be defeind as variables in the domain package to allow for testing.

The adapters will consist of a client (for open ai api calls), repository (for loading and saving files, eg. getImageNames, loadImageByName, saveOutput), and command (please use charm bracelet libs to collect config params and print to screen). Each adapter should include test cases for the happy path and distinct error cases that are defined in the package. Errors related to an adapter implementation should be defined as variables in the adapter that returns them for easy testing. For api errors, please use an api error struct that contains the status and any error message returned by the server.